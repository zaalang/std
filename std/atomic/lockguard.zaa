//
// lockguard
//

import std.tuple;

pub struct lock_guard<T>
{
  typeof(std::fwd_as_tuple(std::declval<T>...)) locks;

  pub lock_guard(T mut & ...locks, #bool adopt = false)
    : locks(locks)
  {
    #if (!adopt)
    {
      #for(var mut &lock : locks)
        lock.lock();
    }
  }

  pub ~lock_guard()
  {
    #for(const i = cast<int>(locks.len) - 1; i >= 0; --i)
      locks.#i.unlock();
  }
}
